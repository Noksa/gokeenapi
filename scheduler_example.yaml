# =============================================================================
# Scheduler Configuration
# =============================================================================
# This file defines scheduled tasks for automated router management.
# Each task executes one or more gokeenapi commands sequentially on one or more router configs.

tasks:
  # Example 1: Run single command periodically (interval-based)
  - name: "Update routes every 3 hours"
    commands:
      - add-routes
    configs:
      - /path/to/router1.yaml
      - /path/to/router2.yaml
      - /path/to/router3.yaml
      - /path/to/router4.yaml
    interval: "3h"  # Supported: "30m", "1h", "2h30m", etc.

  # Example 2: Run single command at specific times (time-based)
  - name: "Update DNS records at fixed times"
    commands:
      - add-dns-records
    configs:
      - /path/to/router1.yaml
    times:
      - "06:00"  # 6 AM
      - "12:00"  # 12 PM
      - "18:00"  # 6 PM

  # Example 3: Run multiple commands sequentially (command chaining)
  - name: "Refresh routes daily"
    commands:
      - delete-routes  # First delete old routes
      - add-routes     # Then add new routes
    configs:
      - /path/to/router1.yaml
      - /path/to/router2.yaml
    times:
      - "02:00"  # 2 AM

  # Example 4: Task with retry on failure
  - name: "Update routes with retry"
    commands:
      - add-routes
    configs:
      - /path/to/router1.yaml
    interval: "1h"
    retry: 3           # Retry up to 3 times on failure
    retryDelay: "30s"  # Wait 30 seconds between retries

  # Example 5: Parallel execution across multiple routers
  - name: "Update routes in parallel"
    commands:
      - add-routes
    configs:
      - /path/to/router1.yaml
      - /path/to/router2.yaml
      - /path/to/router3.yaml
    interval: "3h"
    strategy: "parallel"  # Execute for all configs simultaneously

  # Example 6: Update DNS-routing rules periodically
  - name: "Refresh DNS-routing rules"
    commands:
      - add-dns-routing  # Updates domain-based routing policies
    configs:
      - /path/to/router1.yaml
    interval: "6h"  # Every 6 hours (useful when using domain-url with dynamic lists)

  # Example 7: Complex maintenance task
  - name: "Full router maintenance"
    commands:
      - delete-routes
      - delete-dns-records
      - add-routes
      - add-dns-records
      - add-dns-routing
    configs:
      - /path/to/router1.yaml
    times:
      - "03:00"  # 3 AM
    retry: 2           # Retry up to 2 times if router is unavailable
    retryDelay: "1m"   # Wait 1 minute between retries

# =============================================================================
# Usage:
# =============================================================================
# Run the scheduler:
#   gokeenapi scheduler --config scheduler.yaml
#
# The scheduler will run continuously until stopped (Ctrl+C).
# Tasks are executed sequentially in a FIFO queue - if multiple tasks trigger
# at the same time, they will run one after another.
# Commands within a task run sequentially for each config.
#
# Supported commands:
#   - add-routes
#   - delete-routes
#   - add-dns-records
#   - delete-dns-records
#   - add-dns-routing
#   - delete-dns-routing
#   - add-awg
#   - update-awg
#   - delete-known-hosts
#   - show-interfaces
#   - exec
#
# Notes:
#   - Use "interval" for periodic execution (e.g., every 3 hours)
#   - Use "times" for execution at specific times (24-hour format)
#   - Cannot use both "interval" and "times" in the same task
#   - Each task can target multiple router configs
#   - Tasks execute sequentially in a queue (FIFO)
#   - Commands within a task execute sequentially
#   - If a command fails, remaining commands for that config are skipped
#   - Use "retry" to specify number of retry attempts (default: 0)
#   - Use "retryDelay" to specify delay between retries (default: "1m")
#   - Use "strategy: parallel" to execute commands for all configs simultaneously
#   - Default strategy is "sequential" (one config after another)
